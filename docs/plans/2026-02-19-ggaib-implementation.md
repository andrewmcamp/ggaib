# ggaib Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build an R package providing ggplot2 themes and color scales for the Annenberg Institute at Brown University.

**Architecture:** Standard R package using `roxygen2` for docs, `testthat` for testing, `devtools` workflow. Themes build on `theme_minimal()`. Font fallback system uses `showtext`/`sysfonts` to auto-register Google Fonts when preferred fonts aren't installed.

**Tech Stack:** R, ggplot2, showtext, sysfonts, testthat, roxygen2, devtools

---

### Task 1: Package Scaffolding

**Files:**
- Create: `DESCRIPTION`
- Create: `NAMESPACE`
- Create: `LICENSE`
- Create: `LICENSE.md`
- Create: `.gitignore`
- Create: `.Rbuildignore`
- Create: `ggaib.Rproj`
- Create: `R/ggaib-package.R`
- Create: `tests/testthat.R`
- Create: `tests/testthat/setup.R`

**Step 1: Create DESCRIPTION**

```
Package: ggaib
Title: ggplot2 Themes for the Annenberg Institute at Brown University
Version: 0.1.0
Authors@R:
    person("Andrew", "Camp", role = c("aut", "cre"),
           email = "andrew_camp@brown.edu")
Description: Provides ggplot2 themes and color scales following the visual
    identity of the Annenberg Institute at Brown University. Includes
    publication, presentation, map, and data-dense theme variants plus
    discrete, continuous, and diverging color scales using the Institute's
    brand palette.
License: MIT + file LICENSE
Encoding: UTF-8
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.3.2
Imports:
    ggplot2 (>= 3.4.0),
    showtext,
    sysfonts
Suggests:
    knitr,
    rmarkdown,
    scales,
    testthat (>= 3.0.0)
Config/testthat/edition: 3
VignetteBuilder: knitr
URL: https://github.com/andrewcamp/ggaib
BugReports: https://github.com/andrewcamp/ggaib/issues
```

**Step 2: Create LICENSE files**

`LICENSE`:
```
YEAR: 2026
COPYRIGHT HOLDER: Andrew Camp
```

`LICENSE.md`:
```markdown
# MIT License

Copyright (c) 2026 Andrew Camp

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

**Step 3: Create .gitignore**

```
.Rproj.user
.Rhistory
.RData
.Ruserdata
inst/doc
Meta
doc
*.o
*.so
*.dll
```

**Step 4: Create .Rbuildignore**

```
^.*\.Rproj$
^\.Rproj\.user$
^docs$
^\.claude$
^LICENSE\.md$
```

**Step 5: Create ggaib.Rproj**

```
Version: 1.0

RestoreWorkspace: No
SaveWorkspace: No
AlwaysSaveHistory: Default

EnableCodeIndexing: Yes
UseSpacesForTab: Yes
NumSpacesForTab: 2
Encoding: UTF-8

RnwWeave: Sweave
LaTeX: pdfLaTeX

AutoAppendNewline: Yes
StripTrailingWhitespace: Yes

BuildType: Package
PackageUseDevtools: Yes
PackageInstallArgs: --no-multiarch --with-keep.source
PackageRoxygenize: rd,collate,namespace
```

**Step 6: Create R/ggaib-package.R**

```r
#' @keywords internal
"_PACKAGE"
```

**Step 7: Create NAMESPACE (placeholder — roxygen2 will regenerate)**

```
# Generated by roxygen2: do not edit by hand
```

**Step 8: Create test infrastructure**

`tests/testthat.R`:
```r
library(testthat)
library(ggaib)

test_check("ggaib")
```

`tests/testthat/setup.R`:
```r
library(ggplot2)
```

**Step 9: Commit**

```bash
git add DESCRIPTION NAMESPACE LICENSE LICENSE.md .gitignore .Rbuildignore ggaib.Rproj R/ggaib-package.R tests/testthat.R tests/testthat/setup.R
git commit -m "feat: scaffold ggaib package"
```

---

### Task 2: Color Palette Definitions

**Files:**
- Create: `R/aib_palettes.R`
- Create: `tests/testthat/test-aib_palettes.R`

**Step 1: Write failing tests**

`tests/testthat/test-aib_palettes.R`:
```r
test_that("aib_colors() returns all 8 colors as named vector", {
  colors <- aib_colors()
  expect_length(colors, 8)
  expect_named(colors)
  expect_equal(
    names(colors),
    c("navy", "red", "emerald", "yellow", "sky", "taupe", "brown", "gray")
  )
})

test_that("aib_colors() returns hex codes", {
  colors <- aib_colors()
  expect_true(all(grepl("^#[0-9A-Fa-f]{6}$", colors)))
})

test_that("aib_colors() subsets by name", {
  expect_equal(unname(aib_colors("navy")), "#1B3E6F")
  expect_equal(unname(aib_colors("red")), "#C00404")
  subset <- aib_colors("navy", "emerald")
  expect_length(subset, 2)
  expect_equal(names(subset), c("navy", "emerald"))
})

test_that("aib_colors() errors on invalid name", {
  expect_error(aib_colors("purple"), "not valid AIB colors")
})

test_that("aib_pal() returns a function", {
  pal <- aib_pal()
  expect_type(pal, "closure")
})

test_that("aib_pal() function returns n colors", {
  pal <- aib_pal()
  expect_length(pal(3), 3)
  expect_length(pal(8), 8)
})

test_that("aib_pal() respects contrast-first ordering", {
  pal <- aib_pal()
  colors <- pal(3)
  all_colors <- aib_colors()
  expect_equal(colors, unname(all_colors[1:3]))
})

test_that("aib_pal() warns when n > 8", {
  pal <- aib_pal()
  expect_warning(pal(9), "only 8 colors")
})
```

**Step 2: Run tests to verify they fail**

Run: `Rscript -e "devtools::test(filter = 'aib_palettes')"`
Expected: FAIL — `aib_colors` not found

**Step 3: Write implementation**

`R/aib_palettes.R`:
```r
#' Annenberg Institute Brand Colors
#'
#' Returns a named character vector of hex color codes from the Annenberg
#' Institute brand palette. Pass color names to select specific colors.
#'
#' @param ... Color names to select. If empty, returns all colors.
#'
#' @return A named character vector of hex color codes.
#'
#' @examples
#' aib_colors()
#' aib_colors("navy", "red")
#'
#' @export
aib_colors <- function(...) {
  aib_palette <- c(
    navy    = "#1B3E6F",
    red     = "#C00404",
    emerald = "#00AF9A",
    yellow  = "#EBA900",
    sky     = "#55C8E8",
    taupe   = "#B6B09D",
    brown   = "#503629",
    gray    = "#97A3AE"
  )

  cols <- c(...)

  if (is.null(cols)) {
    return(aib_palette)
  }

  invalid <- setdiff(cols, names(aib_palette))
  if (length(invalid) > 0) {
    stop(
      paste(invalid, collapse = ", "),
      " not valid AIB colors. Choose from: ",
      paste(names(aib_palette), collapse = ", "),
      call. = FALSE
    )
  }

  aib_palette[cols]
}

#' Annenberg Institute Color Palette Function
#'
#' Returns a function that generates `n` colors from the AIB brand palette.
#' Intended for use inside ggplot2 scale functions.
#'
#' @return A function that takes an integer `n` and returns `n` hex color codes.
#'
#' @examples
#' pal <- aib_pal()
#' pal(3)
#'
#' @export
aib_pal <- function() {
  colors <- unname(aib_colors())
  function(n) {
    if (n > length(colors)) {
      warning("AIB palette only has ", length(colors),
              " colors, not ", n, ". Only 8 colors available.",
              call. = FALSE)
    }
    colors[seq_len(min(n, length(colors)))]
  }
}
```

**Step 4: Run tests to verify they pass**

Run: `Rscript -e "devtools::test(filter = 'aib_palettes')"`
Expected: All 8 tests PASS

**Step 5: Commit**

```bash
git add R/aib_palettes.R tests/testthat/test-aib_palettes.R
git commit -m "feat: add brand color palette definitions"
```

---

### Task 3: Font System

**Files:**
- Create: `R/fonts.R`
- Create: `R/zzz.R`
- Create: `tests/testthat/test-fonts.R`

**Step 1: Write failing tests**

`tests/testthat/test-fonts.R`:
```r
test_that("aib_font() returns a character string", {
  result <- aib_font("heading")
  expect_type(result, "character")
  expect_length(result, 1)
})

test_that("aib_font() returns valid role names", {
  expect_no_error(aib_font("heading"))
  expect_no_error(aib_font("body"))
  expect_no_error(aib_font("serif"))
})

test_that("aib_font() errors on invalid role", {
  expect_error(aib_font("monospace"), "not a valid font role")
})

test_that("aib_font_families() returns named list of all roles", {
  families <- aib_font_families()
  expect_type(families, "list")
  expect_named(families, c("heading", "body", "serif"))
})
```

**Step 2: Run tests to verify they fail**

Run: `Rscript -e "devtools::test(filter = 'fonts')"`
Expected: FAIL — `aib_font` not found

**Step 3: Write implementation**

`R/fonts.R`:
```r
#' AIB Font Family Names
#'
#' Returns the registered font family name for a given role. The font system
#' prefers locally installed brand fonts and falls back to Google Fonts
#' alternatives via showtext.
#'
#' @param role One of `"heading"`, `"body"`, or `"serif"`.
#'
#' @return A character string with the font family name.
#'
#' @examples
#' aib_font("heading")
#' aib_font("body")
#'
#' @export
aib_font <- function(role = c("heading", "body", "serif")) {
  role <- match.arg(role)
  families <- aib_font_families()
  families[[role]]
}

#' All AIB Font Families
#'
#' Returns a named list of font family names for all roles.
#'
#' @return A named list with elements `heading`, `body`, and `serif`.
#'
#' @export
aib_font_families <- function() {
  list(
    heading = .aib_env$fonts$heading,
    body    = .aib_env$fonts$body,
    serif   = .aib_env$fonts$serif
  )
}

# Internal environment to store registered font names
.aib_env <- new.env(parent = emptyenv())

# Font configuration: preferred -> fallback
.font_config <- list(
  heading = list(preferred = "Area Normal", fallback = "Albert Sans"),
  body    = list(preferred = "Source Sans Pro", fallback = "Source Sans 3"),
  serif   = list(preferred = "Minion Pro", fallback = "Crimson Text")
)

#' Register AIB fonts
#'
#' Checks for locally installed preferred fonts. If not found, registers
#' Google Font fallbacks via sysfonts and enables showtext rendering.
#'
#' @keywords internal
register_aib_fonts <- function() {
  registered <- sysfonts::font_families()
  fonts <- list()

  for (role in names(.font_config)) {
    config <- .font_config[[role]]
    if (config$preferred %in% registered) {
      fonts[[role]] <- config$preferred
    } else {
      if (!(config$fallback %in% registered)) {
        sysfonts::font_add_google(config$fallback, config$fallback)
      }
      fonts[[role]] <- config$fallback
    }
  }

  .aib_env$fonts <- fonts
  showtext::showtext_auto()
}
```

`R/zzz.R`:
```r
.onLoad <- function(libname, pkgname) {
  register_aib_fonts()
}
```

**Step 4: Run tests to verify they pass**

Run: `Rscript -e "devtools::test(filter = 'fonts')"`
Expected: All 4 tests PASS

**Step 5: Commit**

```bash
git add R/fonts.R R/zzz.R tests/testthat/test-fonts.R
git commit -m "feat: add font registration system with Google Fonts fallback"
```

---

### Task 4: Base Theme — `theme_aib()`

**Files:**
- Create: `R/theme_aib.R`
- Create: `tests/testthat/test-theme_aib.R`

**Step 1: Write failing tests**

`tests/testthat/test-theme_aib.R`:
```r
test_that("theme_aib() returns a ggplot2 theme", {
  thm <- theme_aib()
  expect_s3_class(thm, "theme")
})

test_that("theme_aib() has no gridlines", {
  thm <- theme_aib()
  expect_equal(thm$panel.grid.major, element_blank())
  expect_equal(thm$panel.grid.minor, element_blank())
})

test_that("theme_aib() has axis lines", {
  thm <- theme_aib()
  expect_s3_class(thm$axis.line, "element_line")
})

test_that("theme_aib() has white background", {
  thm <- theme_aib()
  bg <- thm$plot.background
  expect_s3_class(bg, "element_rect")
  expect_equal(bg$fill, "white")
})

test_that("theme_aib() has legend at bottom", {
  thm <- theme_aib()
  expect_equal(thm$legend.position, "bottom")
})

test_that("theme_aib() has left-aligned title", {
  thm <- theme_aib()
  expect_equal(thm$plot.title$hjust, 0)
})

test_that("theme_aib() respects base_size", {
  thm_small <- theme_aib(base_size = 10)
  thm_large <- theme_aib(base_size = 16)
  expect_true(thm_large$text$size > thm_small$text$size)
})

test_that("theme_aib() can be added to a ggplot", {
  p <- ggplot(mtcars, aes(mpg, wt)) + geom_point() + theme_aib()
  expect_s3_class(p, "ggplot")
})
```

**Step 2: Run tests to verify they fail**

Run: `Rscript -e "devtools::test(filter = 'theme_aib')"`
Expected: FAIL — `theme_aib` not found

**Step 3: Write implementation**

`R/theme_aib.R`:
```r
#' Annenberg Institute Base Theme
#'
#' A minimal, publication-quality ggplot2 theme following the Annenberg
#' Institute at Brown University visual identity. Uses brand fonts with
#' automatic Google Fonts fallback.
#'
#' @param base_size Base font size in points. Default is 11.
#' @param base_family Override base font family. If `NULL`, uses the
#'   registered AIB body font.
#'
#' @return A [ggplot2::theme()] object.
#'
#' @examples
#' library(ggplot2)
#' ggplot(mtcars, aes(mpg, wt)) +
#'   geom_point() +
#'   theme_aib()
#'
#' @export
theme_aib <- function(base_size = 11, base_family = NULL) {
  fonts <- aib_font_families()
  if (is.null(base_family)) base_family <- fonts$body

  ggplot2::theme_minimal(base_size = base_size, base_family = base_family) +
    ggplot2::theme(
      # Text
      text = ggplot2::element_text(
        family = base_family,
        size = base_size,
        colour = "#333333"
      ),
      plot.title = ggplot2::element_text(
        family = fonts$heading,
        face = "bold",
        size = base_size * 1.3,
        hjust = 0,
        margin = ggplot2::margin(b = base_size * 0.5)
      ),
      plot.subtitle = ggplot2::element_text(
        family = fonts$heading,
        size = base_size * 1.05,
        hjust = 0,
        margin = ggplot2::margin(b = base_size * 0.7)
      ),
      plot.caption = ggplot2::element_text(
        family = fonts$serif,
        face = "italic",
        size = base_size * 0.8,
        hjust = 1,
        margin = ggplot2::margin(t = base_size * 0.5)
      ),

      # Axes
      axis.line = ggplot2::element_line(colour = "#555555", linewidth = 0.3),
      axis.ticks = ggplot2::element_line(colour = "#555555", linewidth = 0.3),
      axis.text = ggplot2::element_text(
        family = base_family,
        size = base_size * 0.85
      ),
      axis.title = ggplot2::element_text(
        family = base_family,
        size = base_size * 0.95,
        margin = ggplot2::margin(t = base_size * 0.3)
      ),

      # Grid
      panel.grid.major = ggplot2::element_blank(),
      panel.grid.minor = ggplot2::element_blank(),

      # Panel
      panel.background = ggplot2::element_rect(fill = "white", colour = NA),
      panel.border = ggplot2::element_blank(),

      # Plot
      plot.background = ggplot2::element_rect(fill = "white", colour = NA),
      plot.margin = ggplot2::margin(
        t = base_size, r = base_size, b = base_size, l = base_size
      ),

      # Legend
      legend.position = "bottom",
      legend.title = ggplot2::element_blank(),
      legend.key = ggplot2::element_rect(fill = "white", colour = NA),
      legend.background = ggplot2::element_rect(fill = "white", colour = NA),
      legend.direction = "horizontal",

      # Strip (facets)
      strip.background = ggplot2::element_blank(),
      strip.text = ggplot2::element_text(
        family = fonts$heading,
        face = "bold",
        size = base_size * 0.9
      )
    )
}

#' Annenberg Institute Grid Theme
#'
#' Identical to [theme_aib()] but with light gray major gridlines.
#' Use for data-dense plots where gridlines aid readability.
#'
#' @inheritParams theme_aib
#'
#' @return A [ggplot2::theme()] object.
#'
#' @examples
#' library(ggplot2)
#' ggplot(mtcars, aes(mpg, wt)) +
#'   geom_point() +
#'   theme_aib_grid()
#'
#' @export
theme_aib_grid <- function(base_size = 11, base_family = NULL) {
  theme_aib(base_size = base_size, base_family = base_family) +
    ggplot2::theme(
      panel.grid.major = ggplot2::element_line(
        colour = "#E0E0E0",
        linewidth = 0.25
      ),
      panel.grid.minor = ggplot2::element_blank()
    )
}

#' Annenberg Institute Slide Theme
#'
#' Optimized for presentations with larger text and more spacing.
#' Default base size is 16pt.
#'
#' @inheritParams theme_aib
#'
#' @return A [ggplot2::theme()] object.
#'
#' @examples
#' library(ggplot2)
#' ggplot(mtcars, aes(mpg, wt)) +
#'   geom_point() +
#'   theme_aib_slide()
#'
#' @export
theme_aib_slide <- function(base_size = 16, base_family = NULL) {
  theme_aib(base_size = base_size, base_family = base_family) +
    ggplot2::theme(
      plot.title = ggplot2::element_text(
        face = "bold",
        size = base_size * 1.5,
        margin = ggplot2::margin(b = base_size * 0.7)
      ),
      plot.margin = ggplot2::margin(
        t = base_size * 1.5, r = base_size * 1.5,
        b = base_size * 1.5, l = base_size * 1.5
      )
    )
}

#' Annenberg Institute Map Theme
#'
#' A theme for spatial/map plots with no axes, ticks, or gridlines.
#' Retains title, subtitle, and caption styling.
#'
#' @inheritParams theme_aib
#'
#' @return A [ggplot2::theme()] object.
#'
#' @examples
#' library(ggplot2)
#' ggplot(mtcars, aes(mpg, wt)) +
#'   geom_point() +
#'   theme_aib_map()
#'
#' @export
theme_aib_map <- function(base_size = 11, base_family = NULL) {
  theme_aib(base_size = base_size, base_family = base_family) +
    ggplot2::theme(
      axis.line = ggplot2::element_blank(),
      axis.text = ggplot2::element_blank(),
      axis.ticks = ggplot2::element_blank(),
      axis.title = ggplot2::element_blank()
    )
}
```

**Step 4: Run tests to verify they pass**

Run: `Rscript -e "devtools::test(filter = 'theme_aib')"`
Expected: All 8 tests PASS

**Step 5: Commit**

```bash
git add R/theme_aib.R tests/testthat/test-theme_aib.R
git commit -m "feat: add theme_aib() and variants (grid, slide, map)"
```

---

### Task 5: Theme Variants Tests

**Files:**
- Create: `tests/testthat/test-theme_variants.R`

**Step 1: Write tests for theme variants**

`tests/testthat/test-theme_variants.R`:
```r
# theme_aib_grid
test_that("theme_aib_grid() has major gridlines", {
  thm <- theme_aib_grid()
  expect_s3_class(thm$panel.grid.major, "element_line")
})

test_that("theme_aib_grid() has no minor gridlines", {
  thm <- theme_aib_grid()
  expect_equal(thm$panel.grid.minor, element_blank())
})

# theme_aib_slide
test_that("theme_aib_slide() has larger base size", {
  thm <- theme_aib_slide()
  expect_true(thm$text$size >= 16)
})

test_that("theme_aib_slide() can be added to ggplot", {
  p <- ggplot(mtcars, aes(mpg, wt)) + geom_point() + theme_aib_slide()
  expect_s3_class(p, "ggplot")
})

# theme_aib_map
test_that("theme_aib_map() has no axis elements", {
  thm <- theme_aib_map()
  expect_equal(thm$axis.line, element_blank())
  expect_equal(thm$axis.text, element_blank())
  expect_equal(thm$axis.ticks, element_blank())
  expect_equal(thm$axis.title, element_blank())
})

test_that("theme_aib_map() retains title styling", {
  thm <- theme_aib_map()
  expect_s3_class(thm$plot.title, "element_text")
  expect_equal(thm$plot.title$hjust, 0)
})
```

**Step 2: Run tests to verify they pass**

Run: `Rscript -e "devtools::test(filter = 'theme_variants')"`
Expected: All 6 tests PASS (these test already-implemented functions)

**Step 3: Commit**

```bash
git add tests/testthat/test-theme_variants.R
git commit -m "test: add tests for theme variants (grid, slide, map)"
```

---

### Task 6: Discrete Scale Functions

**Files:**
- Create: `R/scale_aib.R`
- Create: `tests/testthat/test-scale_aib.R`

**Step 1: Write failing tests**

`tests/testthat/test-scale_aib.R`:
```r
test_that("scale_color_aib() returns a ggplot scale", {
  sc <- scale_color_aib()
  expect_s3_class(sc, "ScaleDiscrete")
})

test_that("scale_fill_aib() returns a ggplot scale", {
  sc <- scale_fill_aib()
  expect_s3_class(sc, "ScaleDiscrete")
})

test_that("scale_color_aib() can be added to a ggplot", {
  p <- ggplot(mtcars, aes(mpg, wt, color = factor(cyl))) +
    geom_point() +
    scale_color_aib()
  expect_s3_class(p, "ggplot")
})

test_that("scale_fill_aib() can be added to a ggplot", {
  p <- ggplot(mtcars, aes(factor(cyl), fill = factor(cyl))) +
    geom_bar() +
    scale_fill_aib()
  expect_s3_class(p, "ggplot")
})
```

**Step 2: Run tests to verify they fail**

Run: `Rscript -e "devtools::test(filter = 'scale_aib')"`
Expected: FAIL — `scale_color_aib` not found

**Step 3: Write implementation**

`R/scale_aib.R`:
```r
#' Discrete AIB Color Scale
#'
#' Maps categorical variables to the Annenberg Institute brand palette.
#' Colors are ordered for maximum visual contrast.
#'
#' @param ... Additional arguments passed to [ggplot2::discrete_scale()].
#'
#' @return A ggplot2 discrete color scale.
#'
#' @examples
#' library(ggplot2)
#' ggplot(mtcars, aes(mpg, wt, color = factor(cyl))) +
#'   geom_point() +
#'   scale_color_aib()
#'
#' @export
scale_color_aib <- function(...) {
  ggplot2::discrete_scale(
    aesthetics = "colour",
    palette = aib_pal(),
    ...
  )
}

#' @rdname scale_color_aib
#' @export
scale_colour_aib <- scale_color_aib

#' Discrete AIB Fill Scale
#'
#' Maps categorical variables to the Annenberg Institute brand palette
#' for fill aesthetics.
#'
#' @param ... Additional arguments passed to [ggplot2::discrete_scale()].
#'
#' @return A ggplot2 discrete fill scale.
#'
#' @examples
#' library(ggplot2)
#' ggplot(mtcars, aes(factor(cyl), fill = factor(cyl))) +
#'   geom_bar() +
#'   scale_fill_aib()
#'
#' @export
scale_fill_aib <- function(...) {
  ggplot2::discrete_scale(
    aesthetics = "fill",
    palette = aib_pal(),
    ...
  )
}
```

**Step 4: Run tests to verify they pass**

Run: `Rscript -e "devtools::test(filter = 'scale_aib')"`
Expected: All 4 tests PASS

**Step 5: Commit**

```bash
git add R/scale_aib.R tests/testthat/test-scale_aib.R
git commit -m "feat: add discrete color and fill scales"
```

---

### Task 7: Continuous and Diverging Scale Functions

**Files:**
- Modify: `R/scale_aib.R`
- Create: `tests/testthat/test-scale_continuous.R`

**Step 1: Write failing tests**

`tests/testthat/test-scale_continuous.R`:
```r
# Continuous
test_that("scale_color_aib_c() returns a continuous scale", {
  sc <- scale_color_aib_c()
  expect_s3_class(sc, "ScaleContinuous")
})

test_that("scale_fill_aib_c() returns a continuous scale", {
  sc <- scale_fill_aib_c()
  expect_s3_class(sc, "ScaleContinuous")
})

test_that("scale_color_aib_c() accepts custom low/high", {
  sc <- scale_color_aib_c(low = "#C00404", high = "#00AF9A")
  expect_s3_class(sc, "ScaleContinuous")
})

test_that("scale_color_aib_c() can be added to a ggplot", {
  p <- ggplot(mtcars, aes(mpg, wt, color = hp)) +
    geom_point() +
    scale_color_aib_c()
  expect_s3_class(p, "ggplot")
})

# Diverging
test_that("scale_color_aib_div() returns a continuous scale", {
  sc <- scale_color_aib_div()
  expect_s3_class(sc, "ScaleContinuous")
})

test_that("scale_fill_aib_div() returns a continuous scale", {
  sc <- scale_fill_aib_div()
  expect_s3_class(sc, "ScaleContinuous")
})

test_that("scale_color_aib_div() can be added to a ggplot", {
  p <- ggplot(mtcars, aes(mpg, wt, color = hp)) +
    geom_point() +
    scale_color_aib_div()
  expect_s3_class(p, "ggplot")
})
```

**Step 2: Run tests to verify they fail**

Run: `Rscript -e "devtools::test(filter = 'scale_continuous')"`
Expected: FAIL — `scale_color_aib_c` not found

**Step 3: Append to R/scale_aib.R**

Append the following to `R/scale_aib.R`:

```r
#' Continuous AIB Color Scale
#'
#' Creates a continuous color gradient between two brand colors.
#' Defaults to a navy-to-sky gradient.
#'
#' @param low Color for the low end of the gradient. Default is AIB navy.
#' @param high Color for the high end of the gradient. Default is AIB sky.
#' @param ... Additional arguments passed to [ggplot2::scale_color_gradient()].
#'
#' @return A ggplot2 continuous color scale.
#'
#' @examples
#' library(ggplot2)
#' ggplot(mtcars, aes(mpg, wt, color = hp)) +
#'   geom_point() +
#'   scale_color_aib_c()
#'
#' @export
scale_color_aib_c <- function(low = "#1B3E6F", high = "#55C8E8", ...) {
  ggplot2::scale_color_gradient(low = low, high = high, ...)
}

#' @rdname scale_color_aib_c
#' @export
scale_colour_aib_c <- scale_color_aib_c

#' Continuous AIB Fill Scale
#'
#' Creates a continuous fill gradient between two brand colors.
#'
#' @inheritParams scale_color_aib_c
#' @param ... Additional arguments passed to [ggplot2::scale_fill_gradient()].
#'
#' @return A ggplot2 continuous fill scale.
#'
#' @export
scale_fill_aib_c <- function(low = "#1B3E6F", high = "#55C8E8", ...) {
  ggplot2::scale_fill_gradient(low = low, high = high, ...)
}

#' Diverging AIB Color Scale
#'
#' Creates a diverging color gradient. Defaults to red-white-navy.
#'
#' @param low Color for the low end. Default is AIB red.
#' @param mid Color for the midpoint. Default is white.
#' @param high Color for the high end. Default is AIB navy.
#' @param midpoint The data value mapped to the midpoint color. Default is 0.
#' @param ... Additional arguments passed to [ggplot2::scale_color_gradient2()].
#'
#' @return A ggplot2 diverging color scale.
#'
#' @examples
#' library(ggplot2)
#' ggplot(mtcars, aes(mpg, wt, color = hp - mean(hp))) +
#'   geom_point() +
#'   scale_color_aib_div()
#'
#' @export
scale_color_aib_div <- function(low = "#C00404", mid = "white",
                                 high = "#1B3E6F", midpoint = 0, ...) {
  ggplot2::scale_color_gradient2(
    low = low, mid = mid, high = high, midpoint = midpoint, ...
  )
}

#' @rdname scale_color_aib_div
#' @export
scale_colour_aib_div <- scale_color_aib_div

#' Diverging AIB Fill Scale
#'
#' Creates a diverging fill gradient. Defaults to red-white-navy.
#'
#' @inheritParams scale_color_aib_div
#' @param ... Additional arguments passed to [ggplot2::scale_fill_gradient2()].
#'
#' @return A ggplot2 diverging fill scale.
#'
#' @export
scale_fill_aib_div <- function(low = "#C00404", mid = "white",
                                high = "#1B3E6F", midpoint = 0, ...) {
  ggplot2::scale_fill_gradient2(
    low = low, mid = mid, high = high, midpoint = midpoint, ...
  )
}
```

**Step 4: Run tests to verify they pass**

Run: `Rscript -e "devtools::test(filter = 'scale_continuous')"`
Expected: All 7 tests PASS

**Step 5: Commit**

```bash
git add R/scale_aib.R tests/testthat/test-scale_continuous.R
git commit -m "feat: add continuous and diverging color/fill scales"
```

---

### Task 8: Generate Documentation

**Files:**
- Modify: `NAMESPACE` (auto-generated)
- Create: `man/*.Rd` (auto-generated)

**Step 1: Generate roxygen2 docs**

Run: `Rscript -e "devtools::document()"`
Expected: NAMESPACE updated with all exports, man/ directory populated

**Step 2: Verify package builds**

Run: `Rscript -e "devtools::check(document = FALSE, args = '--no-examples')"`
Expected: 0 errors, 0 warnings (notes about non-standard fonts are OK)

**Step 3: Commit**

```bash
git add NAMESPACE man/
git commit -m "docs: generate roxygen2 documentation"
```

---

### Task 9: Vignette

**Files:**
- Create: `vignettes/introduction.Rmd`

**Step 1: Create vignette**

`vignettes/introduction.Rmd`:
````markdown
---
title: "Getting Started with ggaib"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with ggaib}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 4,
  dpi = 150
)
```

## Overview

The `ggaib` package provides ggplot2 themes and color scales for the
Annenberg Institute at Brown University. It includes four theme variants
and discrete, continuous, and diverging color scales using the Institute's
brand palette.

```{r library}
library(ggaib)
library(ggplot2)
```

## Brand Colors

Access the full palette or select specific colors:

```{r colors}
aib_colors()
aib_colors("navy", "red", "emerald")
```

## Themes

### Publication (default)

```{r theme-base}
ggplot(mtcars, aes(mpg, wt)) +
  geom_point(aes(color = factor(cyl)), size = 3) +
  scale_color_aib() +
  labs(
    title = "Vehicle Weight by Fuel Efficiency",
    subtitle = "Motor Trend Car Road Tests, 1974",
    caption = "Source: mtcars dataset"
  ) +
  theme_aib()
```

### Grid

```{r theme-grid}
ggplot(economics, aes(date, unemploy / 1000)) +
  geom_line(color = aib_colors("navy"), linewidth = 0.7) +
  labs(
    title = "US Unemployment Over Time",
    subtitle = "In thousands",
    y = "Unemployed (thousands)",
    x = NULL
  ) +
  theme_aib_grid()
```

### Slide

```{r theme-slide}
ggplot(mtcars, aes(factor(cyl), fill = factor(cyl))) +
  geom_bar() +
  scale_fill_aib() +
  labs(title = "Cars by Cylinder Count") +
  theme_aib_slide()
```

### Map

```{r theme-map}
ggplot(mtcars, aes(mpg, wt)) +
  geom_point(color = aib_colors("navy"), size = 3) +
  labs(title = "Vehicle Weight by Fuel Efficiency") +
  theme_aib_map()
```

## Color Scales

### Continuous

```{r scale-continuous}
ggplot(mtcars, aes(mpg, wt, color = hp)) +
  geom_point(size = 3) +
  scale_color_aib_c() +
  labs(title = "Horsepower Gradient", color = "HP") +
  theme_aib()
```

### Diverging

```{r scale-diverging}
mtcars$hp_centered <- mtcars$hp - mean(mtcars$hp)

ggplot(mtcars, aes(mpg, wt, color = hp_centered)) +
  geom_point(size = 3) +
  scale_color_aib_div() +
  labs(title = "Horsepower (Centered)", color = "HP - Mean") +
  theme_aib()
```
````

**Step 2: Verify vignette builds**

Run: `Rscript -e "devtools::build_vignettes()"`
Expected: HTML vignette generated without errors

**Step 3: Commit**

```bash
git add vignettes/
git commit -m "docs: add introduction vignette with example gallery"
```

---

### Task 10: Final Package Check

**Step 1: Run full test suite**

Run: `Rscript -e "devtools::test()"`
Expected: All tests PASS

**Step 2: Run R CMD check**

Run: `Rscript -e "devtools::check()"`
Expected: 0 errors, 0 warnings

**Step 3: Final commit (if any fixes needed)**

```bash
git add -A
git commit -m "fix: address R CMD check findings"
```
